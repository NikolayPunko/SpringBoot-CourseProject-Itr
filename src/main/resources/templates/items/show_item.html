<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="../../css/style.css"/>
    <script src="https://kit.fontawesome.com/bb8c7ea70f.js" crossorigin="anonymous"></script>
    <title>Show item</title>

</head>
<body>

<header th:insert="header/headerPage.html :: header"></header>

<div class="container" style="margin-top: 100px">

    <div class="container ">

        <div class="row mx-2">
            <div class="col-12 col-md-7 ">

                <div class="row">
                    <p class="h1" th:text="${item.getName()}">Name</p>
                </div>

                <div class="row my-3">
                    <p class="h5" th:text="'Collection: '+${item.getOwner().getName()}">Collection</p>
                </div>

                <div class="row my-3">
                    <p class="h5" th:text="'Owner: '+${item.getOwner().getOwner().getUsername()}">Collection</p>
                </div>

            </div>

            <div class="col-12 col-md-5 my-3">

                <div class="row">
                    <p class="h5">Tags:</p>
                </div>

                <div class="row">
                    <div class="col-auto" th:each="tag : ${item.getTags}">
                        <p th:text="${'#'+tag.getTag()}">Tag</p>
                    </div>
                </div>

            </div>

        </div>

        <div class="row mx-2 my-3 justify-content-between">

            <div class="col-12 col-md-7" th:if="${(fields[6]!=0)||(fields[7]!=0)||(fields[8]!=0)}">

                <div class="row" th:if="${fields[6]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameFirstTextField()}+':'"></p>
                    <div class="text-just mx-2" th:utext="${item.getFirstTextField()}">Content</div>
                </div>

                <div class="row my-4" th:if="${fields[7]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameSecondTextField()}+':'"></p>
                    <div class="text-just mx-2" th:utext="${item.getSecondTextField()}">Content</div>
                </div>

                <div class="row my-4" th:if="${fields[8]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameThirdTextField()}+':'"></p>
                    <div class="text-just mx-2" th:utext="${item.getThirdTextField()}">Content</div>
                </div>

            </div>

            <div class="col-12 col-md-4">

                <div class="row my-2" th:if="${fields[0]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameFirstNumericField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getFirstNumericField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[1]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameSecondNumericField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getSecondNumericField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[2]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameThirdNumericField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getThirdNumericField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[3]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameFirstStringField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getFirstStringField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[4]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameSecondStringField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getSecondStringField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[5]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameThirdStringField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getThirdStringField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[12]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameFirstDateField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getFirstDateField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[13]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameSecondDateField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getSecondDateField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[14]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameThirdDateField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getThirdDateField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[9]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameFirstBooleanField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getFirstBooleanField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[10]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameSecondBooleanField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getSecondBooleanField()}"></p>
                </div>

                <div class="row my-2" th:if="${fields[11]!=0}">
                    <p class="h6" th:text="${item.getOwner().getNameThirdBooleanField()+':'}"></p>
                    <p class="h6 mx-2" th:text="${item.getThirdBooleanField()}"></p>
                </div>

            </div>
        </div>

        <div class="row mx-1 my-2" id="likesBlock">
            <!--Likes-->
        </div>

        <form th:if="${auth_user != null}" class="needs-validation my-2 mx-1" id="commentForm" th:method="POST" th:action="@{/comment/create}" th:object="${comment}"
              novalidate>

            <input type="hidden" name="item_id" th:value="${item.getId()}"/>

            <input type="hidden" name="user_id" th:value="${auth_user.getId()}"/>

            <div class="form-group">
                <label>Add a comment</label>
                <textarea type="text" class="form-control" th:field="*{text}" rows="2" placeholder="Comment"
                          minlength="2" maxlength="300" required></textarea>
                <div class="invalid-feedback">
                    The text field must be between 2 and 300 characters!
                </div>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-secondary">Submit comment</button>
            </div>

        </form>

        <div class="row mx-2 my-3" id="resultsBlock">
            <!--Comments-->
        </div>


    </div>
</div>


<script th:inline="javascript">

    window.onload = function() {
        uploadingComments();
        uploadingLikes();

        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms)
            .forEach(
                function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
    };

    function uploadingComments() {
        var url = '/comment/item/'+[[${item.getId()}]];
        $("#resultsBlock").load(url);
    }

    function uploadingLikes() {
        var url = '/like/item/'+[[${item.getId()}]];
        $("#likesBlock").load(url);
    }

    setInterval(uploadingComments,5000);
    setInterval(uploadingLikes,5000);

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>


</body>
</html>